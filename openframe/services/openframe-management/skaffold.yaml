apiVersion: skaffold/v4beta13
kind: Config
metadata:
  name: openframe-management
build:
  artifacts:
    - image: openframe-management
      context: .
      sync: 
        manual:
          - src: "**/*"
            dest: "/app"
      docker:
        dockerfile: Dockerfile
      hooks:
        before:
          - command: [ "mvn", "clean", "package", "-DskipTests"]
  local:
    push: false                    # BULLETPROOF: Never push to remote registry
    useDockerCLI: false           # Use Skaffold's direct image loading
    useBuildkit: true             # Faster builds
    concurrency: 1                # Prevent build side-effects
    tryImportMissing: true        # Skip rebuilding existing images
  tagPolicy:
    gitCommit: {}                 # Use git commit for tagging (more predictable)
manifests:
  helm:
    releases:
      - name: openframe-management
        chartPath: ../../../manifests/microservices/openframe-management
        namespace: microservices
        createNamespace: true
        valuesFiles:
          - ../../../manifests/microservices/openframe-management/values.yaml
          - ../../../scripts/helm-values.yaml
        setValues:
          image.repo: openframe-management
          image.tag: latest
deploy:
  kubectl: {}
  kubeContext: ""
  statusCheckDeadlineSeconds: 600