[supervisord]
nodaemon=true
logfile=${TACTICAL_DIR}/logs/supervisord.log
pidfile=${TACTICAL_DIR}/supervisor/supervisord.pid
user=${TACTICAL_USER}

[include]
files = ${TACTICAL_DIR}/supervisor/*.conf

[program:nats-server]
command=nats-server --config ${NATS_CONFIG}
stdout_logfile=${TACTICAL_DIR}/logs/nats-server.log
stdout_logfile_maxbytes=0
redirect_stderr=true
autorestart=true
startretries=5
startsecs=5
stopwaitsecs=10
user=${TACTICAL_USER}
environment=NATS_HOME="${TACTICAL_DIR}"

[program:agent-listener]
command=/bin/bash ${TACTICAL_DIR}/supervisor/agent_listener.sh
directory=${TACTICAL_DIR}/api
user=${TACTICAL_USER}
startsecs=5
autorestart=true
startretries=3
stopwaitsecs=10
stdout_logfile=${TACTICAL_DIR}/logs/agent-listener.log
stdout_logfile_maxbytes=50MB
redirect_stderr=true
environment=PYTHONPATH="${TACTICAL_DIR}/api",DJANGO_SETTINGS_MODULE="tacticalrmm.settings"

[program:nats-api]
command=/bin/bash -c "/usr/local/bin/nats-api -config ${NATS_API_CONFIG}"
stdout_logfile=${TACTICAL_DIR}/logs/nats-api.log
stdout_logfile_maxbytes=0
redirect_stderr=true
autorestart=true
startretries=5
startsecs=5
stopwaitsecs=10
user=${TACTICAL_USER}
