name: Generate Matrix

on:
  workflow_call:
    outputs:
      matrix:
        description: "Matrix configuration for all components"
        value: ${{ jobs.matrix.outputs.matrix }}
      matrix_java:
        description: "Matrix configuration for Java components"
        value: ${{ jobs.matrix.outputs.matrix_java }}

jobs:
  matrix:
    name: Generate Matrix
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.matrix.outputs.matrix }}
      matrix_java: ${{ steps.filter.outputs.matrix_java }}
    steps:
      - name: Define Matrix
        id: matrix
        run: |
          matrix_json='[
            {
              "name": "fleetmdm",
              "type": "container",
              "path": "./infrastructure/fleetmdm"
            }
          ]'

          # Write the matrix to the output
          {
            echo 'matrix<<EOF'
            echo "$matrix_json"
            echo EOF
          } >> $GITHUB_OUTPUT

      - name: Filter Java Projects
        id: filter
        run: |
          {
            echo 'matrix_java<<EOF'
            echo '${{ steps.matrix.outputs.matrix }}' | jq '[.[] | select(.type=="java")]'
            echo EOF
          } >> "$GITHUB_OUTPUT"
