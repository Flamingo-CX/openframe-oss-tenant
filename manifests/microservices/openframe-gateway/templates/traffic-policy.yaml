{{- if eq .Values.deployment.ingress "ngrok" }}
apiVersion: ngrok.k8s.ngrok.com/v1alpha1
kind: NgrokTrafficPolicy
metadata:
  name: openframe-gateway
spec:
  policy:
    on_http_request:
      - actions:
          - type: restrict-ips
            config:
              enforce: true
              allow:
              {{- if .Values.allowedIPs }}
                {{- range .Values.allowedIPs }}
                - {{ . | quote }}
                {{- end }}
              {{- else }}
                - "0.0.0.0/0"
              {{- end }}
{{- end }}
