port: 4222

http: 8222

websocket {
  port: 8080
  no_tls: true
}

jetstream {
  store_dir: "/data/jetstream"
}

accounts: {
  SYS: {
    users: [
      { user: "{{ .Values.credentials.admin_user }}", password: "{{ .Values.credentials.admin_pass }}" }
    ],
    exports: [
      { stream: "$SYS.ACCOUNT.DEVICES.CONNECT", accounts: ["SERVICES"] },
      { stream: "$SYS.ACCOUNT.DEVICES.DISCONNECT", accounts: ["SERVICES"] },
      { stream: "device.*.commands", accounts: ["DEVICES"] }
    ]
  },

  DEVICES: {
    users: [
      {
        user: "{{ .Values.credentials.device_user }}",
        password: "{{ .Values.credentials.device_pass }}",
        permissions: {
          subscribe: {
            allow: [
              "device.*.commands",
              "device.*.commands.deliver",
              "events.>",
              "_INBOX.>",
              "$JS.ACK.>",
              "$JS.HB.>",
              "TOOL_INSTALLATION.>",
              "machine.*.tool-installation"
            ]
          },
          publish: { allow: ["$JS.ACK.>", "$JS.HB.>"] }
        }
      }
    ],
    imports: [
      { stream: { account: "SYS", subject: "device.*.commands" } },
      { stream: { account: "SERVICES", subject: "TOOL_INSTALLATION.>" } },
      { service: { account: "SERVICES", subject: "$JS.API.CONSUMER.>" } }
    ],
    jetstream: enabled
  },

  SERVICES: {
    users: [
      {
        user: "service",
        password: "service_pass"
      }
    ],
    imports: [
      { stream: { account: "SYS", subject: "$SYS.ACCOUNT.DEVICES.CONNECT" } },
      { stream: { account: "SYS", subject: "$SYS.ACCOUNT.DEVICES.DISCONNECT" } }
    ],
    exports: [
      { stream: "TOOL_INSTALLATION.>", accounts: ["DEVICES"] },
      { stream: "machine.*.tool-installation", accounts: ["DEVICES"] },
      { service: "$JS.API.CONSUMER.>", accounts: ["DEVICES"] }
    ],
    jetstream: enabled
  }
}

system_account: SYS