global:
  imagePullSecrets: 
    - name: docker-pat-secret

# resourcesPreset: medium
resources:
  # requests:
  #   cpu: 2
  #   memory: 512Mi
  limits:
    cpu: 1
    memory: 2048Mi

extraEnvVars:
  - name: CASSANDRA_AUTHENTICATOR
    value: AllowAllAuthenticator
  - name: CASSANDRA_AUTHORIZER
    value: AllowAllAuthorizer
  - name: CASSANDRA_NATIVE_TRANSPORT_MAX_THREADS
    value: "128"
  # - name: CASSANDRA_NATIVE_TRANSPORT_PORT_SSL
  #   value: "9142"
  - name: CASSANDRA_NATIVE_TRANSPORT_MAX_FRAME_SIZE
    value: "256MB"
  - name: CASSANDRA_STARTUP_TIMEOUT
    value: "300"
  - name: CASSANDRA_SYSTEM_AUTH_BOOTSTRAP_DELAY
    value: "0"
  - name: GOSSIP_WAIT_TIME_IN_MS
    value: "0"

initDB:
  cassandra-init.cql: |
    CREATE KEYSPACE IF NOT EXISTS openframe_events
    WITH replication = {'class': 'SimpleStrategy', 'replication_factor': 1};

    USE openframe_events;

    CREATE TABLE IF NOT EXISTS unified_logs (
        id          text,
        tool_name   text,
        tool_id     text,
        machine_id  text,
        event_type  text,
        timestamp   timestamp,
        operation   text,
        before_data text,
        after_data  text,
        source      text,
        PRIMARY KEY (id, timestamp, tool_name, tool_id, machine_id)
    ) WITH CLUSTERING ORDER BY (timestamp DESC, tool_name ASC, tool_id ASC);

    CREATE INDEX IF NOT EXISTS idx_unified_logs_type ON unified_logs(event_type);
    CREATE INDEX IF NOT EXISTS idx_unified_logs_tool_name ON unified_logs(tool_name);
    CREATE INDEX IF NOT EXISTS idx_unified_logs_tool_id ON unified_logs(tool_id);
    CREATE INDEX IF NOT EXISTS idx_unified_logs_machine_id ON unified_logs(machine_id);
# initDBConfigMap: ""

cluster:
  name: cassandra
  seedCount: 1
  numTokens: 256
  datacenter: dc1
  rack: rack1
  endpointSnitch: SimpleSnitch
  clientEncryption: false
  ## eg:
  ## extraSeeds:
  ##   - hostname/IP
  ##   - hostname/IP
  ##
  extraSeeds: []
  enableUDF: false

metrics:
  enabled: true
  serviceMonitor:
    enabled: true
    namespace: datasources
