suite: skip logic tests
templates:
  - templates/application.yaml
tests:
  - it: self-hosted localhost should skip ngrok-operator and include others
    set:
      deployment.selfHosted.enabled: true
      deployment.selfHosted.ingress.localhost.enabled: true
      deployment.selfHosted.ingress.ngrok.enabled: false
      deployment.saas.enabled: false
    asserts:
      # Count verification
      - hasDocuments:
          count: 35
      # Verify ingress-nginx is included
      - equal:
          path: metadata.name
          value: "ingress-nginx"
        documentSelector:
          path: metadata.name
          value: "ingress-nginx"
      # Verify openframe-authorization-server is included
      - equal:
          path: metadata.name
          value: "openframe-authorization-server"
        documentSelector:
          path: metadata.name
          value: "openframe-authorization-server"

  - it: self-hosted ngrok should skip ingress-nginx and include others
    set:
      deployment.selfHosted.enabled: true
      deployment.selfHosted.ingress.localhost.enabled: false
      deployment.selfHosted.ingress.ngrok.enabled: true
      deployment.saas.enabled: false
    asserts:
      # Count verification
      - hasDocuments:
          count: 35
      # Verify ngrok-operator is included
      - equal:
          path: metadata.name
          value: "ngrok-operator"
        documentSelector:
          path: metadata.name
          value: "ngrok-operator"
      # Verify openframe-authorization-server is included
      - equal:
          path: metadata.name
          value: "openframe-authorization-server"
        documentSelector:
          path: metadata.name
          value: "openframe-authorization-server"

  - it: SaaS should skip both ngrok-operator and auth-server
    set:
      deployment.selfHosted.enabled: false
      deployment.saas.enabled: true
      deployment.saas.ingress.localhost.enabled: true
    asserts:
      # Count verification - 2 apps skipped
      - hasDocuments:
          count: 34
      # Verify ingress-nginx is included
      - equal:
          path: metadata.name
          value: "ingress-nginx"
        documentSelector:
          path: metadata.name
          value: "ingress-nginx"

  - it: should skip explicitly disabled apps
    set:
      deployment.selfHosted.enabled: true
      deployment.selfHosted.ingress.localhost.enabled: true
      deployment.saas.enabled: false
      apps.mongodb.enabled: false
    asserts:
      # One additional app (mongodb) should be skipped
      - hasDocuments:
          count: 34

  - it: both deployment types enabled should use SaaS logic
    set:
      deployment.selfHosted.enabled: true
      deployment.saas.enabled: true
      deployment.saas.ingress.localhost.enabled: true
    asserts:
      # Should follow SaaS logic - skip both ngrok-operator and auth-server
      - hasDocuments:
          count: 34
      # Verify ingress-nginx is included for SaaS
      - equal:
          path: metadata.name
          value: "ingress-nginx"
        documentSelector:
          path: metadata.name
          value: "ingress-nginx"
